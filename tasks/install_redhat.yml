---
# file: tasks/install_redhat.yml

- name: install - add beats repository gpg key
  rpm_key:
    key: "{{beats_repository_gpg_key_url}}"
  become: yes

- name: install - add beats repository
  yumrepo:
    name: beats
    baseurl: "{{beats_repository_url}}"
    enabled: yes
    gpgcheck: yes
    gpgkey: "{{beats_repository_gpg_key_url}}"
  become: yes

- name: install - install beats package from repository
  yum:
    name: "{{item.name}}"
    state: "{{item.state}}"
  notify:
    - trace open files
    - restart {{item.name}}
  become: yes
  with_items: "{{beats_package_state}}"

- name: install - install selected version of beats package
  yum:
    name: "{{beats_package_url}}/{{item.name}}/{{item.name}}-{{item.version}}-{{ansible_machine}}.rpm"
  notify:
    - trace open files
    - restart {{item.name}}
  become: yes
  with_items: "{{beats_package_version}}"

